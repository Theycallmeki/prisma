<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prisma Express Demo</title>
  <style>
    :root { --bg:#0b1020; --card:#111831; --muted:#9aa5b1; --accent:#5eead4; --ok:#10b981; --warn:#f59e0b; }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1020,#0a0f1e);color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
    header{padding:24px 16px;border-bottom:1px solid #1f2937;position:sticky;top:0;background:#0b1020cc;backdrop-filter:saturate(130%) blur(6px)}
    h1{margin:0;font-size:20px;letter-spacing:.3px}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr 1fr}}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.25)}
    .card h2{margin:0;padding:16px 18px;border-bottom:1px solid #1f2937;font-size:16px;color:#eaf2ff}
    .card .content{padding:16px 18px}
    label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
    input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #22314e;background:#0c1328;color:#e5e7eb;outline:none}
    input:focus,select:focus{border-color:#334b7a}
    button{cursor:pointer;border:1px solid #24324f;background:#0e1731;color:#e5e7eb;padding:8px 12px;border-radius:10px;font-size:13px}
    button.primary{background:#0f1c3f;border-color:#1b2b59}
    button.ghost{background:transparent;border-color:#2b3a60}
    button.ok{background:#0f2f27;border-color:#1d4d43;color:#a7f3d0}
    button.warn{background:#3a280c;border-color:#5a3b10;color:#fde68a}
    .row{display:flex;gap:10px;align-items:end;flex-wrap:wrap}
    .row > div{flex:1;min-width:180px}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:#a7b0be;text-align:left;padding:0 8px}
    tbody td{background:#0e1530;border:1px solid #1e2b4e;border-left:none;border-right:none;padding:12px 8px}
    tbody tr{border-radius:12px}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:11px;border:1px solid #25406d;background:#0c1733;color:#c7d2fe}
    .muted{color:var(--muted)}
    .status{margin-top:10px;font-size:13px}
    .sp{-webkit-user-select:none;user-select:none}
    footer{margin-top:24px;color:#9aa5b1;font-size:12px}
    .hr{height:1px;background:#1f2937;margin:14px 0}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:#0d142d;border:1px solid #1f2d52;font-size:12px}
    .actions{display:flex;gap:6px}
  </style>
</head>
<body>
  <header>
    <div class="container" style="padding:0">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <h1>üß≠ Prisma + Express Demo</h1>
        <div class="pill"><span class="sp">‚óè</span><span id="apiBase">/</span></div>
      </div>
    </div>
  </header>

  <div class="container grid">
    <!-- USERS -->
    <section class="card">
      <h2>Users</h2>
      <div class="content">
        <div class="row">
          <div>
            <label for="userEmail">Email</label>
            <input id="userEmail" type="email" placeholder="alice@example.com" />
          </div>
          <div>
            <label for="userName">Name</label>
            <input id="userName" type="text" placeholder="Alice" />
          </div>
          <div>
            <label for="userRole">Role</label>
            <select id="userRole">
              <option value="USER">USER</option>
              <option value="ADMIN">ADMIN</option>
            </select>
          </div>
          <div style="min-width:120px">
            <button class="primary" id="btnCreateUser">Create User</button>
          </div>
        </div>
        <div id="userStatus" class="status muted"></div>
        <div class="hr"></div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Name</th>
              <th>Role</th>
              <th>Posts</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersBody"></tbody>
        </table>
      </div>
    </section>

    <!-- POSTS -->
    <section class="card">
      <h2>Posts</h2>
      <div class="content">
        <div class="row">
          <div>
            <label for="postTitle">Title</label>
            <input id="postTitle" type="text" placeholder="My first post" />
          </div>
          <div>
            <label for="postAuthor">Author</label>
            <select id="postAuthor"></select>
          </div>
          <div style="min-width:120px">
            <button class="primary" id="btnCreatePost">Create Post</button>
          </div>
        </div>
        <div id="postStatus" class="status muted"></div>
        <div class="hr"></div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Author</th>
              <th>Published</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="postsBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <div class="container">
    <footer>
      <div>Tip: create a user first, then create a post with that user as the author.</div>
    </footer>
  </div>

  <script>
    const apiBase = '';
    document.getElementById('apiBase').textContent = apiBase || '/';

    const el = (id)=>document.getElementById(id);
    const usersBody = el('usersBody');
    const postsBody = el('postsBody');

    async function jsonFetch(url, opts={}) {
      const res = await fetch(url, { headers: { 'Content-Type':'application/json' }, ...opts });
      const text = await res.text();
      let data; try { data = text ? JSON.parse(text) : null; } catch { data = text }
      if (!res.ok) throw new Error((data && data.error) || res.status+': '+text);
      return data;
    }

    async function loadUsers() {
      usersBody.innerHTML = '<tr><td class="muted" colspan="6">Loading‚Ä¶</td></tr>';
      try {
        const users = await jsonFetch(apiBase + '/users');
        const sel = el('postAuthor');
        sel.innerHTML = '';
        if (!users.length) sel.innerHTML = '<option value="">No users yet</option>';
        users.forEach(u=>{
          const o=document.createElement('option');
          o.value=u.id; o.textContent=`#${u.id} ‚Ä¢ ${u.email}`; sel.appendChild(o);
        });
        if (users.length===0) {
          usersBody.innerHTML = '<tr><td class="muted" colspan="6">No users yet. Create one above.</td></tr>';
        } else {
          usersBody.innerHTML = users.map(u=>`
            <tr>
              <td>${u.id}</td>
              <td>${u.email}</td>
              <td>${u.name ?? '<span class="muted">‚Äî</span>'}</td>
              <td><span class="badge">${u.role}</span></td>
              <td>${(u.posts||[]).length}</td>
              <td class="actions">
                <button class="warn" onclick="deleteUser(${u.id})">Delete</button>
              </td>
            </tr>`).join('');
        }
      } catch(e) {
        usersBody.innerHTML = `<tr><td colspan="6" class="muted">Error: ${e.message}</td></tr>`;
      }
    }

    async function loadPosts() {
      postsBody.innerHTML = '<tr><td class="muted" colspan="5">Loading‚Ä¶</td></tr>';
      try {
        const posts = await jsonFetch(apiBase + '/posts');
        if (posts.length===0) {
          postsBody.innerHTML = '<tr><td class="muted" colspan="5">No posts yet. Create one above.</td></tr>';
        } else {
          postsBody.innerHTML = posts.map(p=>`
            <tr>
              <td>${p.id}</td>
              <td>${p.title}</td>
              <td>${p.author ? (`#${p.author.id} ‚Ä¢ ${p.author.email}`) : '<span class="muted">(none)</span>'}</td>
              <td>${p.published ? '<span class="badge" style="border-color:#1f4d3f;background:#0b2d25;color:#bbf7d0">YES</span>' : '<span class="badge" style="border-color:#5a3b10;background:#3a280c;color:#fde68a">NO</span>'}</td>
              <td class="actions">
                <button class="ok" ${p.published? 'disabled' : ''} onclick="publish(${p.id})">Publish</button>
                <button class="warn" onclick="deletePost(${p.id})">Delete</button>
              </td>
            </tr>`).join('');
        }
      } catch(e) {
        postsBody.innerHTML = `<tr><td colspan="5" class="muted">Error: ${e.message}</td></tr>`;
      }
    }

    async function createUser() {
      const email = el('userEmail').value.trim();
      const name = el('userName').value.trim() || null;
      const role = el('userRole').value;
      const status = el('userStatus');
      if (!email) { status.textContent = 'Email is required.'; return; }
      status.textContent = 'Creating user‚Ä¶';
      try {
        await jsonFetch(apiBase + '/users',{method:'POST', body: JSON.stringify({ email, name, role })});
        status.textContent = '‚úÖ User created';
        el('userEmail').value=''; el('userName').value=''; el('userRole').value='USER';
        await loadUsers(); await loadPosts();
      } catch(e) { status.textContent = '‚ùå '+e.message; }
    }

    async function createPost() {
      const title = el('postTitle').value.trim();
      const authorId = Number(el('postAuthor').value) || null;
      const status = el('postStatus');
      if (!title) { status.textContent = 'Title is required.'; return; }
      status.textContent = 'Creating post‚Ä¶';
      try {
        await jsonFetch(apiBase + '/posts',{method:'POST', body: JSON.stringify({ title, authorId })});
        status.textContent = '‚úÖ Post created';
        el('postTitle').value='';
        await loadPosts(); await loadUsers();
      } catch(e) { status.textContent = '‚ùå '+e.message; }
    }

    async function publish(id) {
      const status = el('postStatus');
      status.textContent = 'Publishing‚Ä¶';
      try {
        await jsonFetch(apiBase + '/posts/'+id+'/publish',{method:'PUT'});
        status.textContent = '‚úÖ Post published';
        await loadPosts();
      } catch(e) { status.textContent = '‚ùå '+e.message; }
    }

    async function deleteUser(id) {
      const status = el('userStatus');
      status.textContent = 'Deleting‚Ä¶';
      try {
        await jsonFetch(apiBase + '/users/'+id,{method:'DELETE'});
        status.textContent = '‚úÖ User deleted';
        await loadUsers(); await loadPosts();
      } catch(e) { status.textContent = '‚ùå '+e.message; }
    }

    async function deletePost(id) {
      const status = el('postStatus');
      status.textContent = 'Deleting‚Ä¶';
      try {
        await jsonFetch(apiBase + '/posts/'+id,{method:'DELETE'});
        status.textContent = '‚úÖ Post deleted';
        await loadPosts();
      } catch(e) { status.textContent = '‚ùå '+e.message; }
    }

    el('btnCreateUser').addEventListener('click', createUser);
    el('btnCreatePost').addEventListener('click', createPost);

    loadUsers();
    loadPosts();
  </script>
</body>
</html>
